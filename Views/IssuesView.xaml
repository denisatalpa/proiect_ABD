<UserControl x:Class="LibraryManagementSystem.Views.IssuesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:LibraryManagementSystem.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:OverdueToColorConverter x:Key="OverdueToColor"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Issue Book Panel -->
        <Border Grid.Row="0" 
                Background="White" 
                CornerRadius="8" 
                Padding="15"
                Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="ðŸ“‹ ÃŽmprumutÄƒ / ReturneazÄƒ CÄƒrÈ›i"
                           FontSize="22"
                           FontWeight="Bold"
                           Margin="0,0,0,15"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Select Book -->
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="SelecteazÄƒ Carte DisponibilÄƒ:" FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding AvailableBooks}"
                                  SelectedItem="{Binding SelectedBookToIssue}"
                                  DisplayMemberPath="DisplayInfo"
                                  Padding="8"
                                  Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <!-- Select Member -->
                    <StackPanel Grid.Column="1" Margin="0,0,10,0">
                        <TextBlock Text="SelecteazÄƒ Membru:" FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding Members}"
                                  SelectedItem="{Binding SelectedMember}"
                                  DisplayMemberPath="FullName"
                                  Padding="8"
                                  Margin="0,5,0,0"/>
                        <TextBlock Text="{Binding MemberInfo}" 
                                   Foreground="Gray" 
                                   FontSize="11"
                                   Margin="0,3,0,0"/>
                    </StackPanel>
                    
                    <!-- Issue Button -->
                    <Button Grid.Column="2"
                            Content="ðŸ“– ÃŽmprumutÄƒ Carte"
                            Command="{Binding IssueBookCommand}"
                            Padding="20,10"
                            Background="#4CAF50"
                            Foreground="White"
                            FontSize="14"
                            VerticalAlignment="Center"/>
                </Grid>
            </StackPanel>
        </Border>
        
        <!-- Issues List -->
        <Border Grid.Row="1" 
                Background="White" 
                CornerRadius="8"
                Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Filter Buttons -->
                <StackPanel Grid.Row="0" 
                            Orientation="Horizontal" 
                            Margin="0,0,0,10">
                    <TextBlock Text="Istoric ÃŽmprumuturi"
                               FontSize="18"
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               Margin="0,0,20,0"/>
                    <Button Content="Toate ÃŽmprumuturile"
                            Command="{Binding ShowAllIssuesCommand}"
                            Padding="15,8"
                            Margin="0,0,5,0"/>
                    <Button Content="Doar Active"
                            Command="{Binding ShowActiveIssuesCommand}"
                            Padding="15,8"
                            Margin="0,0,5,0"/>
                    <Button Content="âš ï¸ Doar ÃŽntÃ¢rziate"
                            Command="{Binding ShowOverdueIssuesCommand}"
                            Padding="15,8"
                            Background="#FFF3E0"/>
                    <Button Content="ðŸ”„ ReÃ®mprospÄƒteazÄƒ"
                            Command="{Binding RefreshBooksCommand}"
                            Padding="15,8"
                            Margin="20,0,0,0"/>
                </StackPanel>
                
                <!-- Issues DataGrid -->
                <DataGrid Grid.Row="1" 
                          ItemsSource="{Binding BookIssues}"
                          SelectedItem="{Binding SelectedIssue}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID ÃŽmprumut"
                                            Binding="{Binding IssueId}"
                                            Width="70"/>
                        <DataGridTextColumn Header="Carte"
                                            Binding="{Binding Book.Title}"
                                            Width="*"/>
                        <DataGridTextColumn Header="Cod Carte"
                                            Binding="{Binding Book.BookCode}"
                                            Width="100"/>
                        <DataGridTextColumn Header="Membru"
                                            Binding="{Binding Member.FullName}"
                                            Width="130"/>
                        <DataGridTextColumn Header="Tip"
                                            Binding="{Binding Member.MemberType}"
                                            Width="70"/>
                        <DataGridTextColumn Header="Data ÃŽmprumut"
                                            Binding="{Binding IssueDate, StringFormat='dd/MM/yyyy'}"
                                            Width="90"/>
                        <DataGridTextColumn Header="Data ScadenÈ›Äƒ"
                                            Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}"
                                            Width="90"/>
                        <DataGridTextColumn Header="Durata"
                                            Binding="{Binding IssueDuration, StringFormat='{}{0} zile'}"
                                            Width="70"/>
                        <DataGridTemplateColumn Header="Status" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding StatusDisplay}"
                                               Foreground="{Binding IsOverdue, Converter={StaticResource OverdueToColor}}"
                                               FontWeight="SemiBold"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Data Returnare"
                                            Binding="{Binding ReturnDate, StringFormat='dd/MM/yyyy'}"
                                            Width="90"/>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Return Book Button -->
                <StackPanel Grid.Row="2" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right"
                            Margin="0,10,0,0">
                    <TextBlock Text="Procesat de:"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <TextBox Text="{Binding IssuedBy, UpdateSourceTrigger=PropertyChanged}"
                             Width="150"
                             Padding="8"
                             Margin="0,0,10,0"/>
                    <Button Content="ðŸ“¥ ReturneazÄƒ Cartea SelectatÄƒ"
                            Command="{Binding ReturnBookCommand}"
                            Padding="20,10"
                            Background="#2196F3"
                            Foreground="White"
                            FontSize="14"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
